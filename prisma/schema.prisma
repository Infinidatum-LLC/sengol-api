generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AIRiskDetails {
  id               String     @id
  domainRiskId     String     @unique
  useCase          String
  aiMaturity       String
  modelType        Json
  deploymentEnv    String
  dataSensitivity  Json
  scaleMetrics     Json
  complianceReqs   Json
  securityConcerns Json
  performanceRisk  Float
  securityRisk     Float
  complianceRisk   Float
  operationalRisk  Float
  createdAt        DateTime   @default(now())
  updatedAt        DateTime
  DomainRisk       DomainRisk @relation(fields: [domainRiskId], references: [id], onDelete: Cascade)

  @@index([domainRiskId])
}

model Account {
  id                String  @id
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  User              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model AssessmentContext {
  id                 String   @id
  assessmentId       String   @unique
  assessmentType     String
  projectDescription String
  technicalStack     String?
  specificConcerns   String?
  analysis           Json
  confidence         Float    @default(0.0)
  aiModel            String
  tokensUsed         Int
  processingTimeMs   Int
  analysisVersion    String
  createdAt          DateTime @default(now())
  updatedAt          DateTime

  @@index([assessmentId])
  @@index([assessmentType])
  @@index([createdAt])
}

model AuditReport {
  id                       String             @id
  userId                   String
  framework                String
  reportType               String             @default("readiness")
  periodStart              DateTime
  periodEnd                DateTime
  status                   String             @default("draft")
  generatedAt              DateTime?
  approvedAt               DateTime?
  approvedBy               String?
  publishedAt              DateTime?
  totalRequirements        Int
  requirementsWithEvidence Int
  coveragePercentage       Float
  gapCount                 Int
  executiveSummary         String?
  findings                 Json?              @default("[]")
  recommendations          Json?              @default("[]")
  pdfUrl                   String?
  excelUrl                 String?
  htmlUrl                  String?
  evidenceIds              String[]
  metadata                 Json?              @default("{}")
  createdAt                DateTime           @default(now())
  updatedAt                DateTime           @default(now())
  User                     User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  EvidenceArtifact         EvidenceArtifact[] @relation("AuditReportEvidence")

  @@index([coveragePercentage])
  @@index([framework])
  @@index([periodEnd])
  @@index([status])
  @@index([userId])
}

model Backlog {
  id                   String    @id
  featureCode          String    @unique
  category             String
  module               String?
  title                String
  description          String
  status               String    @default("planned")
  implementationStatus String    @default("not_started")
  priority             String    @default("medium")
  effort               String?
  databaseTables       String[]
  apiRoutes            String[]
  uiComponents         String[]
  dependencies         String[]
  tags                 String[]
  assignedTo           String?
  version              String?
  releaseDate          DateTime?
  notes                String?
  testingNotes         String?
  documentationUrl     String?
  issueUrl             String?
  technicalDebt        String?
  futureEnhancements   String?
  startedAt            DateTime?
  completedAt          DateTime?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime
  userId               String?
  User                 User?     @relation(fields: [userId], references: [id])

  @@index([assignedTo])
  @@index([category])
  @@index([createdAt])
  @@index([featureCode])
  @@index([implementationStatus])
  @@index([module])
  @@index([priority])
  @@index([status])
}

model BacklogActivity {
  id           String   @id
  backlogId    String
  userId       String?
  activityType String
  oldValue     String?
  newValue     String?
  comment      String?
  createdAt    DateTime @default(now())
  User         User?    @relation(fields: [userId], references: [id])

  @@index([activityType])
  @@index([backlogId])
  @@index([createdAt])
  @@index([userId])
}

model BaselineReport {
  id           String     @id
  competitorId String
  summary      String
  sections     Json
  generatedAt  DateTime   @default(now())
  metadata     Json?
  Competitor   Competitor @relation(fields: [competitorId], references: [id], onDelete: Cascade)

  @@index([competitorId])
  @@index([generatedAt])
}

model BlockedIP {
  id              String    @id
  ip              String    @unique
  reason          String
  blockedAt       DateTime  @default(now())
  expiresAt       DateTime?
  userAgent       String?
  firstEventId    String?
  requestCount    Int       @default(1)
  permanent       Boolean   @default(false)
  lastSeen        DateTime  @default(now())
  unblockedAt     DateTime?
  unblockedBy     String?
  unblockedReason String?

  @@index([blockedAt])
  @@index([expiresAt])
  @@index([ip])
  @@index([permanent])
}

model Calculation {
  id        String   @id
  userId    String
  projectId String?
  name      String?
  inputs    Json
  results   Json
  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime
  Project   Project? @relation(fields: [projectId], references: [id])
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([userId])
}

model ChangePattern {
  id                  String   @id
  patternType         String
  category            String
  description         String
  confidence          Float
  frequency           String?
  affectedCompetitors String[]
  exampleChangeIds    String[]
  firstDetected       DateTime @default(now())
  lastDetected        DateTime @default(now())
  occurrenceCount     Int      @default(1)

  @@index([category])
  @@index([patternType])
}

model ChecklistResponse {
  id              String   @id
  assessmentId    String
  assessmentType  String
  domain          String
  itemId          String
  response        String
  notes           String?
  confidenceLevel Int?
  answeredAt      DateTime @default(now())
  createdAt       DateTime @default(now())
  updatedAt       DateTime

  @@unique([assessmentId, assessmentType, domain, itemId])
  @@index([answeredAt])
  @@index([assessmentId, assessmentType])
  @@index([assessmentId, domain])
  @@index([itemId])
}

model ChecklistScore {
  id                          String   @id
  assessmentId                String   @unique
  assessmentType              String
  domain                      String
  overallRiskScore            Float
  overallCompliancePercentage Float
  categoryScores              Json
  topGaps                     Json
  summary                     Json
  createdAt                   DateTime @default(now())
  updatedAt                   DateTime

  @@index([assessmentId])
  @@index([assessmentType, domain])
  @@index([createdAt])
}

model CloudRiskDetails {
  id                   String     @id
  domainRiskId         String     @unique
  cloudProvider        String
  architecture         String
  multiRegion          Boolean
  autoScaling          Boolean
  disasterRecovery     String
  monitoringSetup      Boolean
  infrastructureAsCode Boolean
  costOptimization     Boolean
  slaTarget            String
  availabilityRisk     Float
  scalabilityRisk      Float
  costRisk             Float
  vendorLockInRisk     Float
  createdAt            DateTime   @default(now())
  updatedAt            DateTime
  DomainRisk           DomainRisk @relation(fields: [domainRiskId], references: [id], onDelete: Cascade)

  @@index([domainRiskId])
}

model Competitor {
  id                     String                 @id
  subscriptionId         String
  name                   String
  website                String
  industry               String?
  description            String?
  monitorProduct         Boolean                @default(true)
  monitorPricing         Boolean                @default(true)
  monitorHiring          Boolean                @default(true)
  monitorReviews         Boolean                @default(true)
  monitorMarketing       Boolean                @default(true)
  addedAt                DateTime               @default(now())
  lastChecked            DateTime?
  lastScrapedAt          DateTime?
  metadata               Json?
  scrapingStatus         String?                @default("pending")
  BaselineReport         BaselineReport[]
  RivalWatchSubscription RivalWatchSubscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)
  CompetitorChange       CompetitorChange[]
  ContentSource          ContentSource[]
  CuratedChange          CuratedChange[]
  ScrapedContent         ScrapedContent[]

  @@index([scrapingStatus])
  @@index([subscriptionId])
  @@index([website])
}

model CompetitorChange {
  id           String     @id
  competitorId String
  changeType   String
  title        String
  description  String
  url          String?
  screenshot   String?
  summary      String?
  sentiment    String?
  priority     String     @default("medium")
  isRead       Boolean    @default(false)
  isArchived   Boolean    @default(false)
  notes        String?
  detectedAt   DateTime   @default(now())
  createdAt    DateTime   @default(now())
  Competitor   Competitor @relation(fields: [competitorId], references: [id], onDelete: Cascade)

  @@index([changeType])
  @@index([competitorId])
  @@index([detectedAt])
  @@index([isRead])
}

model ComplianceAlert {
  id                    String                @id
  userId                String
  regulationCode        String?
  changeType            String?
  alertType             String
  severity              String
  impactScore           Int
  title                 String
  summary               String
  actionRequired        Boolean               @default(false)
  recommendedActions    String[]
  affectedProjectIds    String[]
  affectedSystemTypes   String[]
  deadline              DateTime?
  expiresAt             DateTime?
  status                String                @default("unread")
  snoozedUntil          DateTime?
  actionedAt            DateTime?
  actionNotes           String?
  deliveredVia          String[]
  emailSentAt           DateTime?
  smsSentAt             DateTime?
  pushSentAt            DateTime?
  metadata              Json?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime
  UserRegulatoryProfile UserRegulatoryProfile @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@index([alertType])
  @@index([createdAt])
  @@index([deadline])
  @@index([regulationCode])
  @@index([severity])
  @@index([status])
  @@index([userId])
}

model ComplianceAssessment {
  id                           String            @id
  userId                       String
  projectId                    String?
  name                         String            @default("Compliance Assessment")
  answers                      Json
  score                        Int
  complianceLevel              String
  recommendations              Json
  createdAt                    DateTime          @default(now())
  updatedAt                    DateTime
  geographyAccountId           String?
  additionalComplianceElements Json?
  complianceNotes              Json?
  coverageDetails              Json?
  coverageScore                Decimal?          @db.Decimal(5, 2)
  jurisdictions                String[]
  questionResponses            Json?
  regulationIds                String[]
  userScores                   Json?
  GeographyAccount             GeographyAccount? @relation(fields: [geographyAccountId], references: [id])
  Project                      Project?          @relation(fields: [projectId], references: [id])
  User                         User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([coverageScore])
  @@index([createdAt])
  @@index([geographyAccountId])
  @@index([projectId])
  @@index([userId])
}

model ComplianceControl {
  id                   String    @id
  userId               String
  framework            String
  requirementId        String
  controlId            String
  title                String
  description          String
  implementationStatus String    @default("not_started")
  ownerId              String?
  assignedTo           String?
  dueDate              DateTime?
  startedAt            DateTime?
  implementedAt        DateTime?
  testedAt             DateTime?
  lastReviewedAt       DateTime?
  testProcedure        String?
  testResults          String?
  testFrequency        String?
  nextTestDate         DateTime?
  evidenceIds          String[]
  effectiveness        String    @default("not_assessed")
  effectivenessNotes   String?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @default(now())
  User                 User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, framework, controlId])
  @@index([implementationStatus])
  @@index([nextTestDate])
  @@index([ownerId])
  @@index([userId, framework])
}

model ComplianceGap {
  id              String    @id
  userId          String
  framework       String
  requirementId   String
  title           String
  description     String
  severity        String    @default("medium")
  impact          String
  status          String    @default("open")
  identifiedAt    DateTime  @default(now())
  resolvedAt      DateTime?
  remediationPlan String?
  assignedTo      String?
  targetDate      DateTime?
  effort          String?
  resolutionNotes String?
  evidenceIds     String[]
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @default(now())
  User            User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([severity])
  @@index([status])
  @@index([targetDate])
  @@index([userId, framework])
}

model CompliancePlaybook {
  id                         String                       @id
  regulationCode             String?
  title                      String
  description                String
  aiSystemType               String?
  jurisdiction               String?
  category                   String
  difficulty                 String                       @default("medium")
  estimatedHours             Int?
  isPublic                   Boolean                      @default(false)
  createdBy                  String
  useCount                   Int                          @default(0)
  completionRate             Float?
  metadata                   Json?
  createdAt                  DateTime                     @default(now())
  updatedAt                  DateTime
  CompliancePlaybookInstance CompliancePlaybookInstance[]
  CompliancePlaybookStep     CompliancePlaybookStep[]

  @@index([aiSystemType])
  @@index([category])
  @@index([isPublic])
  @@index([regulationCode])
}

model CompliancePlaybookInstance {
  id                    String                @id
  playbookId            String
  userId                String
  projectId             String?
  status                String                @default("not-started")
  progress              Float                 @default(0)
  completedSteps        Int[]
  evidenceArtifacts     Json?
  startedAt             DateTime?
  estimatedCompletion   DateTime?
  completedAt           DateTime?
  assignedToUserId      String?
  notes                 String?
  metadata              Json?
  createdAt             DateTime              @default(now())
  updatedAt             DateTime
  CompliancePlaybook    CompliancePlaybook    @relation(fields: [playbookId], references: [id], onDelete: Cascade)
  Project               Project?              @relation(fields: [projectId], references: [id])
  UserRegulatoryProfile UserRegulatoryProfile @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@unique([playbookId, userId, projectId])
  @@index([projectId])
  @@index([status])
  @@index([userId])
}

model CompliancePlaybookStep {
  id                 String             @id
  playbookId         String
  stepNumber         Int
  title              String
  description        String
  instructions       String?
  examples           Json?
  templates          Json?
  evidenceRequired   String[]
  evidenceTemplates  Json?
  estimatedMinutes   Int?
  dependsOnSteps     Int[]
  metadata           Json?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime
  CompliancePlaybook CompliancePlaybook @relation(fields: [playbookId], references: [id], onDelete: Cascade)

  @@index([playbookId])
  @@index([stepNumber])
}

model ComplianceRequirement {
  id                  String   @id
  framework           String
  requirementId       String
  category            String
  title               String
  description         String
  controlType         String
  aiSpecific          Boolean  @default(false)
  evidenceTypes       String[]
  frequency           String?
  implementationGuide String?
  testingProcedure    String?
  automationLevel     String   @default("manual")
  priority            String   @default("medium")
  externalLinks       Json?    @default("[]")
  createdAt           DateTime @default(now())
  updatedAt           DateTime @default(now())

  @@unique([framework, requirementId])
  @@index([aiSpecific])
  @@index([category])
  @@index([framework])
}

model ContentSource {
  id                   String              @id
  competitorId         String
  sourceType           String
  sourceUrl            String?
  searchQuery          String?
  isActive             Boolean             @default(true)
  checkFrequency       String              @default("daily")
  lastChecked          DateTime?
  createdAt            DateTime            @default(now())
  updatedAt            DateTime
  intelligenceSourceId String?
  Competitor           Competitor          @relation(fields: [competitorId], references: [id], onDelete: Cascade)
  IntelligenceSource   IntelligenceSource? @relation(fields: [intelligenceSourceId], references: [id])

  @@index([competitorId])
  @@index([intelligenceSourceId])
  @@index([isActive])
  @@index([sourceType])
}

model ContentTemplate {
  id             String   @id
  domain         String
  pagePath       String?
  selectors      Json
  extractionType String
  parseRules     Json
  name           String
  description    String?
  isActive       Boolean  @default(true)
  timesUsed      Int      @default(0)
  successRate    Float?
  createdAt      DateTime @default(now())
  updatedAt      DateTime

  @@index([domain])
  @@index([extractionType])
  @@index([isActive])
}

model ContextAnalysisCache {
  id                 String   @id
  descriptionHash    String   @unique
  projectDescription String
  analysis           Json
  hitCount           Int      @default(0)
  lastAccessedAt     DateTime @default(now())
  createdAt          DateTime @default(now())

  @@index([createdAt])
  @@index([descriptionHash])
}

model ContextualizedQuestion {
  id                  String    @id
  assessmentContextId String
  baseQuestionId      String
  category            String
  originalText        String
  contextualizedText  String
  contextReasoning    String
  relevanceScore      Float
  priority            Int       @default(0)
  userAnswer          String?
  answeredAt          DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime

  @@index([assessmentContextId])
  @@index([category])
  @@index([relevanceScore])
}

model ContinuousMonitoring {
  id                  String                @id
  assessmentId        String
  userId              String
  isActive            Boolean               @default(true)
  frequency           String
  lastScannedAt       DateTime?
  nextScanAt          DateTime
  alertThreshold      Float                 @default(0.5)
  createdAt           DateTime              @default(now())
  RiskAssessment      RiskAssessment        @relation(fields: [assessmentId], references: [id], onDelete: Cascade)
  User                User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  MonitoringRiskAlert MonitoringRiskAlert[]

  @@index([nextScanAt])
  @@index([userId, isActive])
}

model CuratedChange {
  id                   String          @id
  competitorId         String
  scrapedContentId     String?
  changeType           String
  category             String?
  title                String
  description          String
  beforeContent        Json?
  afterContent         Json
  contentUrl           String?
  screenshotUrl        String?
  aiSummary            String?
  aiInsights           Json?
  sentiment            String?
  impact               String?
  priority             String          @default("medium")
  confidence           Float?
  qualityScore         Float?
  relevanceScore       Float?
  noveltyScore         Float?
  isDuplicate          Boolean         @default(false)
  duplicateOf          String?
  similarityHash       String?
  isRead               Boolean         @default(false)
  isArchived           Boolean         @default(false)
  isFavorite           Boolean         @default(false)
  userNotes            String?
  userTags             String[]
  detectedAt           DateTime        @default(now())
  createdAt            DateTime        @default(now())
  updatedAt            DateTime
  actionRecommendation String?
  actionType           String?
  contextMetadata      Json?
  sourceName           String?
  sourceType           String?
  sourceUrl            String?
  Competitor           Competitor      @relation(fields: [competitorId], references: [id], onDelete: Cascade)
  ScrapedContent       ScrapedContent? @relation(fields: [scrapedContentId], references: [id])

  @@index([actionType])
  @@index([changeType])
  @@index([competitorId])
  @@index([detectedAt])
  @@index([isDuplicate])
  @@index([isRead])
  @@index([qualityScore])
  @@index([similarityHash])
}

model CyberRiskDetails {
  id                   String     @id
  domainRiskId         String     @unique
  attackSurface        Json
  authMethods          Json
  encryptionAtRest     Boolean
  encryptionInTransit  Boolean
  mfaEnabled           Boolean
  backupStrategy       String
  incidentResponsePlan Boolean
  securityTestingFreq  String
  siem                 Boolean
  attackSurfaceRisk    Float
  identityAccessRisk   Float
  dataProtectionRisk   Float
  incidentResponseRisk Float
  createdAt            DateTime   @default(now())
  updatedAt            DateTime
  DomainRisk           DomainRisk @relation(fields: [domainRiskId], references: [id], onDelete: Cascade)

  @@index([domainRiskId])
}

model Domain {
  id                String       @id
  slug              String       @unique
  name              String
  description       String?
  isActive          Boolean      @default(true)
  sortOrder         Int          @default(0)
  icon              String?
  color             String?
  calculatorVersion String       @default("1.0")
  riskCategories    Json
  createdAt         DateTime     @default(now())
  updatedAt         DateTime
  DomainRisk        DomainRisk[]

  @@index([isActive])
  @@index([slug])
}

model DomainRisk {
  id                String            @id
  assessmentId      String
  domainId          String
  overallScore      Float
  categoryScores    Json
  topRisks          Json
  recommendations   Json
  mitigationCost    Float?
  completedAt       DateTime          @default(now())
  calculatorVersion String            @default("1.0")
  AIRiskDetails     AIRiskDetails?
  CloudRiskDetails  CloudRiskDetails?
  CyberRiskDetails  CyberRiskDetails?
  RiskAssessment    RiskAssessment    @relation(fields: [assessmentId], references: [id], onDelete: Cascade)
  Domain            Domain            @relation(fields: [domainId], references: [id], onDelete: Cascade)
  RiskEvidence      RiskEvidence[]

  @@unique([assessmentId, domainId])
  @@index([assessmentId])
  @@index([domainId])
}

model DynamicRiskQuestion {
  id                String         @id
  assessmentId      String
  questionText      String
  category          String
  weight            Decimal        @db.Decimal(3, 2)
  incidentCount     Int
  avgSeverity       Decimal        @db.Decimal(3, 2)
  relevanceScore    Decimal        @db.Decimal(3, 2)
  evidenceIncidents Json?
  evidenceSummary   String?
  reasoning         Json?
  aiGenerated       Boolean        @default(true)
  createdAt         DateTime       @default(now())
  RiskAssessment    RiskAssessment @relation(fields: [assessmentId], references: [id], onDelete: Cascade)

  @@index([assessmentId])
  @@index([category])
  @@index([weight])
}

model EmailVerification {
  id        String   @id
  userId    String
  token     String   @unique
  expires   DateTime
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([userId])
}

model EvidenceArtifact {
  id                  String        @id
  userId              String
  artifactType        String
  category            String
  complianceFramework String
  requirementId       String?
  title               String
  description         String
  fileUrl             String?
  sourceType          String?
  sourceId            String?
  metadata            Json?         @default("{}")
  verifiedBy          String?
  verifiedAt          DateTime?
  reviewStatus        String        @default("pending")
  reviewNotes         String?
  collectedAt         DateTime
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @default(now())
  User                User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  AuditReport         AuditReport[] @relation("AuditReportEvidence")

  @@index([artifactType])
  @@index([collectedAt(sort: Desc)])
  @@index([requirementId])
  @@index([reviewStatus])
  @@index([sourceType, sourceId])
  @@index([userId, complianceFramework])
}

model Framework {
  id             String   @id
  userId         String
  projectId      String?
  name           String?
  answers        Json
  recommendation Json
  notes          String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime
  Project        Project? @relation(fields: [projectId], references: [id])
  User           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([userId])
}

model GeographyAccount {
  id                     String                   @id
  userId                 String
  name                   String
  jurisdiction           String
  country                String?
  region                 String?
  regulatoryBody         String?
  billingStatus          String                   @default("active")
  stripeCustomerId       String?                  @unique
  stripeSubId            String?                  @unique
  billingEmail           String?
  billingCurrency        String                   @default("USD")
  tier                   String                   @default("free")
  projectLimit           Int                      @default(3)
  userLimit              Int                      @default(5)
  currentPeriodEnd       DateTime?
  trialEnds              DateTime?
  dataResidency          String?
  isActive               Boolean                  @default(true)
  isPrimary              Boolean                  @default(false)
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  ComplianceAssessment   ComplianceAssessment[]
  User                   User                     @relation(fields: [userId], references: [id], onDelete: Cascade)
  GeographyAccountMember GeographyAccountMember[]
  Project                Project[]
  RiskAssessment         RiskAssessment[]

  @@index([billingStatus])
  @@index([isActive])
  @@index([jurisdiction])
  @@index([userId])
}

model GeographyAccountMember {
  id                 String           @id
  geographyAccountId String
  userId             String
  role               String           @default("member")
  permissions        Json?
  invitedAt          DateTime         @default(now())
  joinedAt           DateTime?
  invitedBy          String?
  GeographyAccount   GeographyAccount @relation(fields: [geographyAccountId], references: [id], onDelete: Cascade)
  User               User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([geographyAccountId, userId])
  @@index([geographyAccountId])
  @@index([userId])
}

model IndustryBenchmark {
  id                 String   @id
  industry           String
  aiSystemType       String
  averageRiskScore   Float
  medianRiskScore    Float
  p25RiskScore       Float
  p75RiskScore       Float
  p90RiskScore       Float
  sampleSize         Int
  dataSource         String   @default("incident_analysis")
  topRiskFactors     Json
  avgComplianceScore Float?
  commonViolations   Json?
  avgIncidentCost    Float?
  maxIncidentCost    Float?
  lastUpdated        DateTime @default(now())
  createdAt          DateTime @default(now())

  @@unique([industry, aiSystemType])
  @@index([aiSystemType])
  @@index([industry])
  @@index([lastUpdated])
}

model IntelligenceSource {
  id            String          @id
  name          String          @unique
  sourceType    String
  baseUrl       String?
  apiEndpoint   String?
  requiresAuth  Boolean         @default(false)
  authType      String?
  scraperConfig Json?
  description   String?
  isActive      Boolean         @default(true)
  priority      Int             @default(5)
  timesUsed     Int             @default(0)
  lastUsed      DateTime?
  successRate   Float?          @default(1.0)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime
  ContentSource ContentSource[]

  @@index([isActive])
  @@index([priority])
  @@index([sourceType])
}

model MarketingEvent {
  id         String   @id
  event      String
  userId     String?
  email      String?
  properties Json?
  timestamp  DateTime @default(now())
  createdAt  DateTime @default(now())

  @@index([email])
  @@index([event])
  @@index([timestamp])
  @@index([userId])
}

model ModelEndpoint {
  id                   String            @id
  userId               String
  projectId            String?
  endpointUrl          String
  modelType            String
  modelName            String?
  apiKeyHash           String            @unique
  monitoringEnabled    Boolean           @default(true)
  alertThresholds      Json              @default("{\"drift_score\": 70, \"response_time_ms\": 5000, \"error_rate_percent\": 5, \"token_usage_spike_percent\": 50}")
  notificationChannels Json              @default("{\"email\": true, \"slack\": false}")
  baselineCaptured     Boolean           @default(false)
  baselineStatistics   Json?
  metadata             Json?
  deletedAt            DateTime?
  createdAt            DateTime          @default(now())
  updatedAt            DateTime
  User                 User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  ModelMetric          ModelMetric[]
  MonitoringAlert      MonitoringAlert[]

  @@index([apiKeyHash])
  @@index([deletedAt])
  @@index([monitoringEnabled])
  @@index([userId])
}

model ModelMetric {
  id                   String        @id
  endpointId           String
  timestamp            DateTime      @default(now())
  responseTimeMs       Int?
  errorRate            Float?
  tokenUsage           Int?
  predictionDriftScore Float?
  dataQualityScore     Float?
  requestId            String?
  success              Boolean?
  errorMessage         String?
  metadata             Json?
  createdAt            DateTime      @default(now())
  ModelEndpoint        ModelEndpoint @relation(fields: [endpointId], references: [id], onDelete: Cascade)

  @@index([endpointId, success])
  @@index([endpointId, timestamp(sort: Desc)])
  @@index([timestamp(sort: Desc)])
}

model ModelMetricsHourly {
  id                String   @id
  endpointId        String
  hourBucket        DateTime
  avgResponseTimeMs Int?
  p50ResponseTimeMs Int?
  p95ResponseTimeMs Int?
  p99ResponseTimeMs Int?
  avgErrorRate      Float?
  totalRequests     Int
  failedRequests    Int
  totalTokens       Int?
  avgDriftScore     Float?
  createdAt         DateTime @default(now())

  @@unique([endpointId, hourBucket])
  @@index([endpointId, hourBucket(sort: Desc)])
}

model MonitoringAlert {
  id                String        @id
  endpointId        String
  alertType         String
  severity          String
  title             String
  message           String
  thresholdValue    Float?
  actualValue       Float?
  metadata          Json?
  resolved          Boolean       @default(false)
  resolvedAt        DateTime?
  resolvedBy        String?
  resolutionNotes   String?
  notificationsSent Json          @default("[]")
  createdAt         DateTime      @default(now())
  updatedAt         DateTime
  ModelEndpoint     ModelEndpoint @relation(fields: [endpointId], references: [id], onDelete: Cascade)

  @@index([alertType])
  @@index([endpointId])
  @@index([resolved, createdAt(sort: Desc)])
  @@index([severity, createdAt(sort: Desc)])
}

model MonitoringRiskAlert {
  id                   String               @id
  monitoringId         String
  alertType            String
  severity             String
  title                String
  description          String
  oldValue             Json?
  newValue             Json?
  triggerData          Json
  isRead               Boolean              @default(false)
  isAcknowledged       Boolean              @default(false)
  acknowledgedAt       DateTime?
  createdAt            DateTime             @default(now())
  ContinuousMonitoring ContinuousMonitoring @relation(fields: [monitoringId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([monitoringId, isRead])
  @@index([severity])
}

model NewsletterSubscriber {
  id        String   @id
  email     String   @unique
  name      String?
  source    String?
  status    String   @default("active")
  createdAt DateTime @default(now())
  updatedAt DateTime

  @@index([email])
}

model NotificationChannel {
  id                 String    @id
  userId             String
  endpointId         String?
  channelType        String
  name               String
  config             Json
  isEnabled          Boolean   @default(true)
  alertSeverities    String[]  @default(["critical", "high"])
  alertTypes         String[]  @default(["drift", "performance", "error_rate", "token_spike"])
  quietHoursEnabled  Boolean   @default(false)
  quietHoursStart    String?
  quietHoursEnd      String?
  quietHoursTimezone String?   @default("UTC")
  dailyDigestEnabled Boolean   @default(false)
  dailyDigestTime    String?
  lastTestedAt       DateTime?
  lastNotificationAt DateTime?
  failureCount       Int       @default(0)
  lastError          String?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime
  User               User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([channelType])
  @@index([endpointId])
  @@index([isEnabled])
  @@index([userId])
}

model PasswordResetToken {
  id        String   @id
  userId    String
  token     String   @unique
  expires   DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([userId])
}

model PricingAnalyticsEvent {
  id               String   @id
  userId           String?
  sessionId        String?
  eventType        String
  eventCategory    String
  assessmentType   String?
  currentTier      String?
  targetTier       String?
  subscriptionPlan String?
  price            Float?
  metadata         Json?
  userAgent        String?
  referrer         String?
  createdAt        DateTime @default(now())
  User             User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([eventCategory])
  @@index([eventType])
  @@index([sessionId])
  @@index([userId])
}

model PricingChangeLog {
  id         String   @id
  planId     String
  changeType String
  field      String?
  oldValue   String?
  newValue   String?
  changedBy  String?
  reason     String?
  createdAt  DateTime @default(now())

  @@index([changeType])
  @@index([createdAt])
  @@index([planId])
}

model PricingFeature {
  id          String      @id
  planId      String
  name        String
  description String?
  category    String?
  sortOrder   Int         @default(0)
  highlighted Boolean     @default(false)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime
  PricingPlan PricingPlan @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@index([planId])
  @@index([sortOrder])
}

model PricingLimit {
  id          String      @id
  planId      String
  limitKey    String
  limitValue  Int
  featureKey  String?
  enabled     Boolean     @default(false)
  metadata    Json?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime
  PricingPlan PricingPlan @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@unique([planId, featureKey])
  @@unique([planId, limitKey])
  @@index([featureKey])
  @@index([limitKey])
  @@index([planId])
}

model PricingPlan {
  id              String           @id
  planId          String           @unique
  name            String
  description     String?
  price           Int
  interval        String
  popular         Boolean          @default(false)
  active          Boolean          @default(true)
  sortOrder       Int              @default(0)
  stripePriceId   String?
  stripeProductId String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime
  PricingFeature  PricingFeature[]
  PricingLimit    PricingLimit[]

  @@index([active])
  @@index([planId])
  @@index([sortOrder])
}

model ProductAccess {
  id             String    @id
  userId         String
  productSlug    String
  productName    String
  accessType     String
  status         String    @default("active")
  expiresAt      DateTime?
  grantedAt      DateTime  @default(now())
  purchaseId     String?
  subscriptionId String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime
  User           User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productSlug])
  @@index([productSlug])
  @@index([status])
  @@index([userId])
}

model Project {
  id                         String                       @id
  userId                     String
  name                       String
  description                String?
  status                     String                       @default("active")
  color                      String?
  createdAt                  DateTime                     @default(now())
  updatedAt                  DateTime
  geographyAccountId         String?
  Calculation                Calculation[]
  ComplianceAssessment       ComplianceAssessment[]
  CompliancePlaybookInstance CompliancePlaybookInstance[]
  Framework                  Framework[]
  GeographyAccount           GeographyAccount?            @relation(fields: [geographyAccountId], references: [id])
  User                       User                         @relation(fields: [userId], references: [id], onDelete: Cascade)
  RiskAssessment             RiskAssessment[]
  sengol_score_history       sengol_score_history[]

  @@index([geographyAccountId])
  @@index([status])
  @@index([userId])
}

model Purchase {
  id               String   @id
  userId           String
  productId        String
  productName      String
  productType      String
  volume           String?
  amount           Int
  currency         String   @default("usd")
  status           String
  stripePaymentId  String?
  stripeCustomerId String?
  downloadUrl      String?
  trackingNumber   String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime
  User             User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([userId])
}

model RegulatoryEnforcement {
  id               String    @id
  enforcingBody    String
  targetCompany    String
  caseNumber       String?
  regulationCode   String?
  violationType    String
  description      String
  penalty          BigInt?
  penaltyType      String?
  outcome          String
  aiSummary        String?
  lessonsLearned   String[]
  relevanceToUsers String[]
  filedDate        DateTime?
  settledDate      DateTime?
  officialUrl      String?
  pressRelease     String?
  metadata         Json?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime

  @@index([enforcingBody])
  @@index([filedDate])
  @@index([regulationCode])
  @@index([settledDate])
  @@index([violationType])
}

model RegulatoryJurisdiction {
  id                           String                   @id
  code                         String                   @unique
  name                         String
  parentId                     String?
  level                        String
  population                   BigInt?
  gdpUsd                       BigInt?
  isActive                     Boolean                  @default(true)
  createdAt                    DateTime                 @default(now())
  updatedAt                    DateTime
  RegulatoryJurisdiction       RegulatoryJurisdiction?  @relation("RegulatoryJurisdictionToRegulatoryJurisdiction", fields: [parentId], references: [id])
  other_RegulatoryJurisdiction RegulatoryJurisdiction[] @relation("RegulatoryJurisdictionToRegulatoryJurisdiction")
  UserRegulatoryProfile        UserRegulatoryProfile[]

  @@index([code])
  @@index([isActive])
  @@index([level])
}

model RiskAssessment {
  id                           String                  @id
  userId                       String
  projectId                    String?
  name                         String
  industry                     String
  useCase                      String?
  companySize                  String
  aiMaturity                   String?
  modelType                    Json?
  deploymentEnv                String?
  dataSensitivity              Json?
  scaleMetrics                 Json?
  complianceReqs               Json?
  securityConcerns             Json?
  businessImpact               Json
  budgetRange                  String
  timeline                     String
  teamSize                     Int
  overallRiskScore             Float
  performanceRisk              Float?
  securityRisk                 Float?
  complianceRisk               Float?
  operationalRisk              Float?
  topRisks                     Json?
  recommendation               Json?
  mitigationCost               Float?
  createdAt                    DateTime                @default(now())
  updatedAt                    DateTime
  aggregateTopRisks            Json?
  overallRecommendation        Json?
  brandImportance              String?
  geographyAccountId           String?
  revenueAtRisk                Int?
  usersAffected                Int?
  additionalComplianceElements Json?
  additionalRiskElements       Json?
  aiRiskScore                  Int?
  analysisCompletedAt          DateTime?
  analysisStatus               String                  @default("draft")
  cloudRiskScore               Int?
  complianceCoverageDetails    Json?
  complianceCoverageScore      Decimal?                @db.Decimal(5, 2)
  complianceDetails            Json?
  complianceNotes              Json?
  complianceQuestionResponses  Json?
  complianceScore              Int?
  complianceUserScores         Json?
  cyberRiskScore               Int?
  dataTypes                    String[]
  deploymentType               String?
  dynamicQuestions             Json?
  evidenceCount                Int                     @default(0)
  jurisdictions                String[]
  letterGrade                  String?
  questionGeneratedAt          DateTime?
  regulationIds                String[]
  riskCoverageDetails          Json?
  riskCoverageScore            Decimal?                @db.Decimal(5, 2)
  riskNotes                    Json?
  riskQuestionResponses        Json?
  sengolScore                  Int?
  systemContext                Json?
  systemCriticality            String?
  systemDescription            String?
  techStack                    String[]                @default([])
  technologyStack              String[]
  useWeightedScoring           Boolean                 @default(false)
  userRiskScores               Json?
  weightedScoreResults         Json?
  selectedDomains              String[]                @default([])
  dataSources                  String[]                @default([])
  councilId                    String?
  ContinuousMonitoring         ContinuousMonitoring[]
  DomainRisk                   DomainRisk[]
  DynamicRiskQuestion          DynamicRiskQuestion[]
  GeographyAccount             GeographyAccount?       @relation(fields: [geographyAccountId], references: [id])
  Project                      Project?                @relation(fields: [projectId], references: [id])
  User                         User                    @relation(fields: [userId], references: [id], onDelete: Cascade)
  RiskPredictionOutcome        RiskPredictionOutcome[]
  WeightedRiskScore            WeightedRiskScore[]

  @@index([createdAt])
  @@index([geographyAccountId])
  @@index([projectId])
  @@index([riskCoverageScore])
  @@index([useWeightedScoring])
  @@index([userId])
}

model RiskEvidence {
  id               String     @id
  domainRiskId     String
  failurePatternId String     @db.Uuid
  relevanceScore   Float
  category         String
  weight           Float
  matchFactors     Json?
  createdAt        DateTime   @default(now())
  DomainRisk       DomainRisk @relation(fields: [domainRiskId], references: [id], onDelete: Cascade)

  @@index([category])
  @@index([domainRiskId])
  @@index([relevanceScore])
}

model RiskPredictionOutcome {
  id             String         @id
  assessmentId   String
  riskId         String
  predictedScore Float
  actualOutcome  String?
  timeToEvent    Int?
  verifiedAt     DateTime?
  verifiedBy     String?
  notes          String?
  createdAt      DateTime       @default(now())
  RiskAssessment RiskAssessment @relation(fields: [assessmentId], references: [id], onDelete: Cascade)

  @@index([actualOutcome])
  @@index([assessmentId])
}

model RivalWatchSubscription {
  id               String       @id
  userId           String
  tier             String
  status           String       @default("active")
  competitorLimit  Int
  stripeSubId      String?      @unique
  stripeCustId     String?
  currentPeriodEnd DateTime?
  cancelAt         DateTime?
  trialEnds        DateTime?
  createdAt        DateTime     @default(now())
  updatedAt        DateTime
  Competitor       Competitor[]
  User             User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([stripeSubId])
  @@index([userId])
}

model RivalWatchWaitlist {
  id          String   @id
  email       String   @unique
  name        String?
  company     String?
  role        String?
  competitors Int      @default(5)
  source      String?
  status      String   @default("pending")
  createdAt   DateTime @default(now())
  updatedAt   DateTime

  @@index([email])
  @@index([status])
}

model ScrapedContent {
  id               String          @id
  competitorId     String
  scrapeJobId      String?
  url              String
  rawHtml          String
  rawText          String
  rawMetadata      Json?
  extractedData    Json?
  contentHash      String
  scrapedAt        DateTime        @default(now())
  httpStatus       Int?
  loadTime         Int?
  screenshotUrl    String?
  processingStatus String          @default("pending")
  processedAt      DateTime?
  errorMessage     String?
  sourceName       String?
  sourceType       String          @default("website")
  sourceUrl        String?
  findings         Json?
  CuratedChange    CuratedChange[]
  Competitor       Competitor      @relation(fields: [competitorId], references: [id], onDelete: Cascade)

  @@index([competitorId])
  @@index([contentHash])
  @@index([processingStatus])
  @@index([scrapedAt])
  @@index([sourceType])
}

model SecurityAlert {
  id             String    @id
  alertType      String
  severity       String
  title          String
  description    String
  ip             String?
  userAgent      String?
  eventCount     Int       @default(1)
  firstEventAt   DateTime
  lastEventAt    DateTime
  acknowledged   Boolean   @default(false)
  acknowledgedAt DateTime?
  acknowledgedBy String?
  resolved       Boolean   @default(false)
  resolvedAt     DateTime?
  resolvedBy     String?
  metadata       Json?
  createdAt      DateTime  @default(now())
  notes          String?

  @@index([acknowledged])
  @@index([alertType])
  @@index([createdAt])
  @@index([resolved])
  @@index([severity])
}

model SecurityEvent {
  id             String   @id
  eventType      String
  ip             String
  userAgent      String
  url            String
  path           String
  method         String
  reason         String
  severity       String
  blocked        Boolean  @default(true)
  referer        String?
  origin         String?
  acceptHeader   String?
  acceptLanguage String?
  acceptEncoding String?
  isBot          Boolean  @default(false)
  isSuspicious   Boolean  @default(false)
  botType        String?
  requestId      String?  @unique
  metadata       Json?
  createdAt      DateTime @default(now())
  city           String?
  country        String?
  region         String?

  @@index([blocked])
  @@index([createdAt])
  @@index([eventType])
  @@index([ip])
  @@index([isBot])
  @@index([severity])
}

model Session {
  id           String   @id
  sessionToken String   @unique
  userId       String
  expires      DateTime
  User         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model ToolSubscription {
  id               String    @id
  userId           String
  planId           String
  status           String    @default("active")
  amount           Int       @default(5000)
  billingPeriod    String    @default("monthly")
  stripeSubId      String?   @unique
  stripeCustId     String?
  currentPeriodEnd DateTime?
  cancelAt         DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime
  User             User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, planId])
  @@unique([userId, planId], map: "ToolSubscription_userId_toolSlug_key")
  @@index([planId])
  @@index([status])
  @@index([stripeSubId])
  @@index([userId])
}

model ToolUsage {
  id         String   @id
  userId     String?
  email      String?
  toolSlug   String
  usageType  String
  sessionId  String?
  ipAddress  String?
  inputData  Json?
  resultData Json?
  createdAt  DateTime @default(now())
  User       User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([email])
  @@index([sessionId])
  @@index([toolSlug])
  @@index([userId])
}

model User {
  id                     String                   @id
  name                   String?
  email                  String                   @unique
  emailVerified          DateTime?
  image                  String?
  password               String?
  role                   String                   @default("user")
  company                String?
  jobTitle               String?
  industry               String?
  teamSize               String?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  currentGeographyId     String?
  Account                Account[]
  AuditReport            AuditReport[]
  Backlog                Backlog[]
  BacklogActivity        BacklogActivity[]
  Calculation            Calculation[]
  ComplianceAssessment   ComplianceAssessment[]
  ComplianceControl      ComplianceControl[]
  ComplianceGap          ComplianceGap[]
  ContinuousMonitoring   ContinuousMonitoring[]
  EmailVerification      EmailVerification[]
  EvidenceArtifact       EvidenceArtifact[]
  Framework              Framework[]
  GeographyAccount       GeographyAccount[]
  GeographyAccountMember GeographyAccountMember[]
  ModelEndpoint          ModelEndpoint[]
  NotificationChannel    NotificationChannel[]
  PasswordResetToken     PasswordResetToken[]
  PricingAnalyticsEvent  PricingAnalyticsEvent[]
  ProductAccess          ProductAccess[]
  Project                Project[]
  Purchase               Purchase[]
  RiskAssessment         RiskAssessment[]
  RivalWatchSubscription RivalWatchSubscription[]
  Session                Session[]
  ToolSubscription       ToolSubscription[]
  ToolUsage              ToolUsage[]
  UserRegulatoryProfile  UserRegulatoryProfile?
}

model UserRegulatoryProfile {
  id                         String                       @id
  userId                     String                       @unique
  aiSystemTypes              String[]
  industries                 String[]
  companySize                String?
  annualRevenue              String?
  dataVolume                 String?
  alertPreferences           Json
  onboardingCompleted        Boolean                      @default(false)
  onboardingStep             Int                          @default(0)
  createdAt                  DateTime                     @default(now())
  updatedAt                  DateTime
  ComplianceAlert            ComplianceAlert[]
  CompliancePlaybookInstance CompliancePlaybookInstance[]
  User                       User                         @relation(fields: [userId], references: [id], onDelete: Cascade)
  RegulatoryJurisdiction     RegulatoryJurisdiction[]

  @@index([userId])
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model WeightedRiskScore {
  id             String         @id
  assessmentId   String
  questionId     String?
  status         String
  rawScore       Int
  weight         Decimal        @db.Decimal(3, 2)
  weightedScore  Decimal        @db.Decimal(5, 2)
  category       String?
  createdAt      DateTime       @default(now())
  RiskAssessment RiskAssessment @relation(fields: [assessmentId], references: [id], onDelete: Cascade)

  @@index([assessmentId])
  @@index([category])
}

model cep_anomalies {
  id                BigInt    @id @default(autoincrement())
  domain            String    @db.VarChar(50)
  signal_type       String?   @db.VarChar(100)
  anomaly_type      String    @db.VarChar(50)
  severity          String    @db.VarChar(20)
  z_score           Decimal?  @db.Decimal(6, 2)
  observed_value    Decimal   @db.Decimal(10, 2)
  baseline_value    Decimal   @db.Decimal(10, 2)
  baseline_stddev   Decimal?  @db.Decimal(10, 2)
  deviation_pct     Decimal?  @db.Decimal(6, 2)
  time_window_start DateTime  @db.Timestamptz(6)
  time_window_end   DateTime  @db.Timestamptz(6)
  description       String?
  status            String?   @default("detected") @db.VarChar(50)
  detected_at       DateTime? @default(now()) @db.Timestamptz(6)
  resolved_at       DateTime? @db.Timestamptz(6)

  @@index([domain, detected_at(sort: Desc)], map: "idx_cep_anomalies_domain_time")
  @@index([severity, detected_at(sort: Desc)], map: "idx_cep_anomalies_severity")
  @@index([status, detected_at(sort: Desc)], map: "idx_cep_anomalies_status")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model cep_correlated_events {
  id                 BigInt    @id @default(autoincrement())
  pattern_id         Int
  pattern_name       String    @db.VarChar(100)
  confidence_score   Decimal   @db.Decimal(4, 3)
  event_ids          String[]
  time_window_start  DateTime  @db.Timestamptz(6)
  time_window_end    DateTime  @db.Timestamptz(6)
  impact_assessment  String?
  recommended_action String?
  metadata           Json?
  status             String?   @default("detected") @db.VarChar(50)
  detected_at        DateTime? @default(now()) @db.Timestamptz(6)
  resolved_at        DateTime? @db.Timestamptz(6)

  @@index([pattern_id, detected_at(sort: Desc)], map: "idx_cep_correlated_pattern")
  @@index([status, detected_at(sort: Desc)], map: "idx_cep_correlated_status")
  @@index([time_window_start, time_window_end], map: "idx_cep_correlated_time_window")
}

model cep_pattern_templates {
  id                     Int       @id @default(autoincrement())
  pattern_name           String    @unique @db.VarChar(100)
  pattern_type           String    @db.VarChar(50)
  description            String?
  detection_window_hours Int
  min_confidence         Decimal?  @default(0.7) @db.Decimal(3, 2)
  config                 Json
  is_active              Boolean?  @default(true)
  created_at             DateTime? @default(now()) @db.Timestamptz(6)
  updated_at             DateTime? @default(now()) @db.Timestamptz(6)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model cep_signal_correlations {
  id                      Int       @id @default(autoincrement())
  signal_type_a           String    @db.VarChar(100)
  signal_type_b           String    @db.VarChar(100)
  correlation_coefficient Decimal?  @db.Decimal(4, 3)
  time_lag_hours          Int?      @default(0)
  co_occurrence_count     Int?      @default(0)
  total_observations      Int?      @default(0)
  confidence              Decimal?  @db.Decimal(3, 2)
  last_updated            DateTime? @default(now()) @db.Timestamptz(6)

  @@unique([signal_type_a, signal_type_b, time_lag_hours])
  @@index([signal_type_a, signal_type_b], map: "idx_cep_correlations_types")
}

model cep_signal_events {
  id              BigInt    @id @default(autoincrement())
  event_id        String    @unique @db.VarChar(255)
  domain          String    @db.VarChar(50)
  signal_type     String    @db.VarChar(100)
  signal_strength Decimal   @db.Decimal(3, 2)
  event_timestamp DateTime  @db.Timestamptz(6)
  source_id       String?   @db.VarChar(100)
  metadata        Json?
  created_at      DateTime? @default(now()) @db.Timestamptz(6)

  @@index([domain, event_timestamp(sort: Desc)], map: "idx_cep_signals_domain_time")
  @@index([signal_type, event_timestamp(sort: Desc)], map: "idx_cep_signals_type_time")
}

model cloud_incident_staging {
  id                  String   @id
  incident_date       DateTime @db.Timestamp(6)
  cloud_provider      String
  service_affected    String
  failure_type        String
  severity            String
  regions_affected    Json?
  duration_hours      Float?
  estimated_cost      BigInt?
  customers_affected  Int?
  services_impacted   Json?
  root_cause          String?
  human_error         Boolean?
  detection_method    String?
  time_to_detect_min  Int?
  time_to_resolve_min Int?
  had_multi_region    Boolean?
  had_auto_failover   Boolean?
  had_backups         Boolean?
  source_url          String   @unique
  source_type         String
  crawled_at          DateTime @default(now()) @db.Timestamp(6)
  raw_content         String?
  tags                Json?

  @@index([incident_date], map: "idx_cloud_staging_date")
  @@index([cloud_provider], map: "idx_cloud_staging_provider")
  @@index([severity], map: "idx_cloud_staging_severity")
  @@index([failure_type], map: "idx_cloud_staging_type")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model crawl_targets {
  id                   String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  url                  String    @unique
  domain               String
  name                 String
  description          String?
  target_type          String
  data_types           String[]
  company_identifier   String?
  company_name         String?
  ticker_symbol        String?
  scraper_type         String
  scraper_config       Json?
  frequency            String    @default("daily")
  last_crawled_at      DateTime? @db.Timestamp(6)
  next_crawl_at        DateTime? @db.Timestamp(6)
  is_active            Boolean?  @default(true)
  is_paused            Boolean?  @default(false)
  total_crawls         Int?      @default(0)
  successful_crawls    Int?      @default(0)
  failed_crawls        Int?      @default(0)
  avg_response_time_ms Int?
  last_success_at      DateTime? @db.Timestamp(6)
  last_failure_at      DateTime? @db.Timestamp(6)
  consecutive_failures Int?      @default(0)
  created_at           DateTime  @default(now()) @db.Timestamp(6)
  updated_at           DateTime  @default(now()) @db.Timestamp(6)
  metadata             Json?

  @@index([company_identifier], map: "idx_targets_company")
  @@index([domain], map: "idx_targets_domain")
}

model crawler_performance {
  id                    Int      @id @default(autoincrement())
  date                  DateTime @db.Date
  domain                String   @db.VarChar(20)
  sources_crawled       Int      @default(0)
  items_collected       Int      @default(0)
  success_rate          Float    @default(0.0)
  avg_items_per_source  Float    @default(0.0)
  active_workers        Int      @default(0)
  total_runtime_minutes Int      @default(0)
  target_total          Int?
  achievement_rate      Float?
  variance_from_target  Float?
  created_at            DateTime @default(now())

  @@unique([date, domain])
  @@index([date])
}

model crawler_sources {
  id                    Int       @id @default(autoincrement())
  source_id             String    @unique @db.VarChar(100)
  domain                String    @db.VarChar(20)
  source_type           String    @db.VarChar(50)
  url                   String
  name                  String    @db.VarChar(200)
  is_active             Boolean   @default(true)
  quality_score         Float     @default(0.5)
  avg_items_per_run     Int       @default(0)
  success_rate          Float     @default(1.0)
  last_crawled_at       DateTime?
  last_success_at       DateTime?
  total_items_collected Int       @default(0)
  consecutive_failures  Int       @default(0)
  discovered_at         DateTime  @default(now())
  discovered_by         String    @default("manual") @db.VarChar(50)
  priority              Int       @default(5)
  created_at            DateTime  @default(now())
  updated_at            DateTime  @default(now())

  @@index([domain, is_active])
  @@index([priority])
  @@index([quality_score])
}

model crawler_targets {
  id               Int       @id @default(autoincrement())
  date             DateTime  @db.Date
  domain           String    @db.VarChar(20)
  target_total     Int
  target_min       Int
  target_max       Int
  actual_collected Int       @default(0)
  achievement_rate Float     @default(0.0)
  status           String    @default("pending") @db.VarChar(20)
  created_at       DateTime  @default(now())
  completed_at     DateTime?

  @@unique([date, domain])
  @@index([date, status])
}

model crawler_workers {
  id                    Int       @id @default(autoincrement())
  worker_id             String    @unique @db.VarChar(100)
  domain                String    @db.VarChar(20)
  status                String    @default("idle") @db.VarChar(20)
  current_source_id     String?   @db.VarChar(100)
  items_collected_today Int       @default(0)
  last_run_at           DateTime?
  last_success_at       DateTime?
  assigned_sources      Json      @default("[]")
  max_concurrent        Int       @default(1)
  created_at            DateTime  @default(now())
  updated_at            DateTime  @default(now())

  @@index([domain, status])
}

model cyber_incident_staging {
  id                  String   @id
  incident_date       DateTime @db.Timestamp(6)
  organization        String?
  attack_type         String
  severity            String
  industry            String?
  attack_vector       String?
  compromised_data    Json?
  estimated_cost      BigInt?
  downtime_hours      Int?
  detection_method    String?
  time_to_detect_hrs  Int?
  time_to_respond_hrs Int?
  had_mfa             Boolean?
  had_backups         Boolean?
  had_ir_plan         Boolean?
  source_url          String   @unique
  source_type         String
  crawled_at          DateTime @default(now()) @db.Timestamp(6)
  raw_content         String?
  tags                Json?

  @@index([incident_date], map: "idx_cyber_staging_date")
  @@index([severity], map: "idx_cyber_staging_severity")
  @@index([attack_type], map: "idx_cyber_staging_type")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model data_sources {
  id                   String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  source_key           String    @unique
  source_name          String
  source_type          String
  base_url             String?
  data_types_supported String[]
  companies_supported  String?
  rate_limit_rpm       Int?
  rate_limit_rph       Int?
  rate_limit_rpd       Int?
  requires_api_key     Boolean?  @default(false)
  api_key_env_var      String?
  reliability_score    Float?
  data_quality_score   Float?
  avg_latency_ms       Int?
  is_active            Boolean?  @default(true)
  is_premium           Boolean?  @default(false)
  total_requests       Int?      @default(0)
  successful_requests  Int?      @default(0)
  failed_requests      Int?      @default(0)
  last_used_at         DateTime? @db.Timestamp(6)
  created_at           DateTime  @default(now()) @db.Timestamp(6)
  updated_at           DateTime  @default(now()) @db.Timestamp(6)
  documentation_url    String?
  notes                String?
  metadata             Json?

  @@index([source_key], map: "idx_sources_key")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model detected_changes {
  id                 String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  previous_scrape_id String?  @db.Uuid
  current_scrape_id  String?  @db.Uuid
  change_type        String
  field_path         String
  previous_value     String?
  current_value      String?
  change_magnitude   Float?
  change_direction   String?
  significance_score Float?
  is_significant     Boolean? @default(false)
  company_identifier String
  detected_at        DateTime @default(now()) @db.Timestamp(6)
  metadata           Json?

  @@index([company_identifier], map: "idx_changes_company")
  @@index([detected_at(sort: Desc)], map: "idx_changes_detected")
  @@index([change_type], map: "idx_changes_type")
}

model extraction_templates {
  id                String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  template_name     String
  domain_pattern    String
  url_pattern       String?
  data_type         String
  extraction_method String
  extraction_rules  Json
  validation_schema Json?
  success_rate      Float?
  times_used        Int?      @default(0)
  last_used_at      DateTime? @db.Timestamp(6)
  is_active         Boolean?  @default(true)
  created_at        DateTime  @default(now()) @db.Timestamp(6)
  updated_at        DateTime  @default(now()) @db.Timestamp(6)
  created_by        String?
  notes             String?
  metadata          Json?

  @@index([data_type], map: "idx_templates_data_type")
  @@index([domain_pattern], map: "idx_templates_domain")
}

model failure_patterns {
  id                   String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  source_scrape_id     String?   @db.Uuid
  failure_type         String
  severity             String
  industry             String?
  use_case             String?
  model_type           String?
  deployment_scale     String?
  root_cause           String?
  warning_signals      Json?
  mitigation           String?
  prevention           String?
  impact               Json?
  detection_time_hours Int?
  confidence_score     Float?
  is_verified          Boolean?  @default(false)
  data_sources         Json?
  tags                 String[]
  created_at           DateTime  @default(now()) @db.Timestamp(6)
  updated_at           DateTime  @default(now()) @db.Timestamp(6)
  verified_by          String?
  verified_at          DateTime? @db.Timestamp(6)
  notes                String?
  source_url           String?
  extraction_method    String?   @default("manual")

  @@index([created_at(sort: Desc)], map: "idx_failure_created")
  @@index([industry], map: "idx_failure_industry")
  @@index([model_type], map: "idx_failure_model_type")
  @@index([severity], map: "idx_failure_severity")
  @@index([tags], map: "idx_failure_tags", type: Gin)
  @@index([failure_type], map: "idx_failure_type")
  @@index([use_case], map: "idx_failure_use_case")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model normalized_metrics {
  id                 String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  source_id          String?   @db.Uuid
  metric_type        String
  metric_name        String
  metric_category    String?
  metric_value       Decimal?  @db.Decimal
  metric_value_text  String?
  metric_unit        String?
  currency           String?
  time_period        String?
  period_start       DateTime? @db.Date
  period_end         DateTime? @db.Date
  company_identifier String
  company_name       String?
  ticker_symbol      String?
  domain             String?
  confidence_score   Float?
  data_quality_flag  String?
  created_at         DateTime  @default(now()) @db.Timestamp(6)
  updated_at         DateTime  @default(now()) @db.Timestamp(6)
  metadata           Json?

  @@index([metric_category], map: "idx_normalized_category")
  @@index([company_identifier], map: "idx_normalized_company")
  @@index([created_at(sort: Desc)], map: "idx_normalized_created")
  @@index([domain], map: "idx_normalized_domain")
  @@index([period_start(sort: Desc), period_end(sort: Desc)], map: "idx_normalized_period")
  @@index([ticker_symbol], map: "idx_normalized_ticker")
  @@index([metric_type], map: "idx_normalized_type")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model performance_benchmarks {
  id                             String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  source_scrape_id               String?  @db.Uuid
  benchmark_name                 String?
  use_case                       String
  industry                       String?
  model_type                     String?
  deployment_scale               String?
  accuracy_baseline              Float?
  accuracy_acceptable_threshold  Float?
  accuracy_alert_threshold       Float?
  accuracy_critical_threshold    Float?
  latency_p50_baseline_ms        Int?
  latency_p95_baseline_ms        Int?
  latency_p99_baseline_ms        Int?
  latency_alert_threshold_ms     Int?
  latency_critical_threshold_ms  Int?
  throughput_baseline_rps        Int?
  throughput_alert_threshold_rps Int?
  cost_per_1k_inferences         Decimal? @db.Decimal(10, 6)
  cost_alert_threshold           Decimal? @db.Decimal(10, 6)
  cost_critical_threshold        Decimal? @db.Decimal(10, 6)
  data_drift_sensitivity         String?
  retraining_frequency           String?
  monitoring_requirements        Json?
  confidence_score               Float?
  sample_size                    Int?
  created_at                     DateTime @default(now()) @db.Timestamp(6)
  updated_at                     DateTime @default(now()) @db.Timestamp(6)
  data_source                    String?
  source_url                     String?
  notes                          String?
  metadata                       Json?

  @@index([created_at(sort: Desc)], map: "idx_benchmark_created")
  @@index([industry], map: "idx_benchmark_industry")
  @@index([model_type], map: "idx_benchmark_model_type")
  @@index([use_case], map: "idx_benchmark_use_case")
}

model regulation_changes {
  id                    String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  regulation_id         String?   @db.Uuid
  change_date           DateTime  @db.Date
  change_type           String?   @db.VarChar(50)
  change_summary        String?
  affected_requirements String[]  @db.Uuid
  source_url            String?
  created_at            DateTime? @default(now()) @db.Timestamp(6)
  metadata              Json?
}

model regulation_requirements {
  id                    String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  regulation_id         String?   @db.Uuid
  requirement_text      String
  requirement_number    String?   @db.VarChar(100)
  category              String?   @db.VarChar(100)
  risk_level            String?   @db.VarChar(50)
  obligation_type       String?   @db.VarChar(50)
  applies_to            String[]
  penalties             String?
  parent_requirement_id String?   @db.Uuid
  created_at            DateTime? @default(now()) @db.Timestamp(6)
  updated_at            DateTime? @default(now()) @db.Timestamp(6)
  metadata              Json?

  @@index([category], map: "idx_requirements_category")
  @@index([regulation_id], map: "idx_requirements_regulation")
  @@index([risk_level], map: "idx_requirements_risk_level")
}

model regulation_violations {
  id                 String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  incident_id        String?   @db.Uuid
  requirement_id     String?   @db.Uuid
  violation_type     String?   @db.VarChar(100)
  severity           String?   @db.VarChar(50)
  financial_penalty  Decimal?  @db.Decimal(15, 2)
  enforcement_action String?
  evidence           String?
  created_at         DateTime? @default(now()) @db.Timestamp(6)
  metadata           Json?

  @@index([incident_id], map: "idx_violations_incident")
  @@index([requirement_id], map: "idx_violations_requirement")
}

model regulations {
  id                  String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                String    @db.VarChar(255)
  short_name          String?   @db.VarChar(100)
  jurisdiction        String    @db.VarChar(100)
  regulatory_body     String?   @db.VarChar(255)
  effective_date      DateTime? @db.Date
  last_updated_date   DateTime? @db.Date
  version             String?   @db.VarChar(50)
  status              String?   @default("active") @db.VarChar(50)
  full_text           String?
  summary             String?
  url                 String
  pdf_url             String?
  source_language     String?   @default("en") @db.VarChar(10)
  regulation_type     String?   @db.VarChar(50)
  industry_scope      String[]
  geographic_scope    String[]
  created_at          DateTime? @default(now()) @db.Timestamp(6)
  updated_at          DateTime? @default(now()) @db.Timestamp(6)
  metadata            Json?
  regulation_code     String?
  title               String?
  risk_score          Decimal?  @default(5.0) @db.Decimal
  category            String?
  industries          String[]
  requirements        Json?
  penalties           Json?
  enforcement_actions Json?
  source_crawl_id     String?   @db.Uuid
  regulatory_body_id  String?   @db.Uuid

  @@unique([name, jurisdiction, version])
  @@index([regulation_code], map: "idx_regulations_code")
  @@index([jurisdiction], map: "idx_regulations_jurisdiction")
  @@index([risk_score(sort: Desc)], map: "idx_regulations_risk_score")
  @@index([status], map: "idx_regulations_status")
  @@index([regulation_type], map: "idx_regulations_type")
}

model regulatory_bodies {
  id              String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name            String
  acronym         String?
  country         String?
  region          String?
  industry        String[]
  website_url     String    @unique
  api_endpoint    String?
  jurisdiction    String[]
  authority_level String?
  is_active       Boolean?  @default(true)
  crawl_frequency String?   @default("daily")
  last_crawled_at DateTime? @db.Timestamp(6)
  metadata        Json?
  created_at      DateTime? @default(now()) @db.Timestamp(6)
  updated_at      DateTime? @default(now()) @db.Timestamp(6)

  @@index([is_active], map: "idx_regulatory_bodies_active")
  @@index([country], map: "idx_regulatory_bodies_country")
}

model regulatory_updates {
  id                  String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  regulation_id       String?   @db.Uuid
  update_type         String
  title               String?
  description         String?
  effective_date      DateTime? @db.Date
  detected_at         DateTime? @default(now()) @db.Timestamp(6)
  source_url          String?
  impact_assessment   String?
  affected_industries String[]
  requires_action     Boolean?  @default(false)
  action_deadline     DateTime? @db.Date
  processed           Boolean?  @default(false)
  created_at          DateTime? @default(now()) @db.Timestamp(6)

  @@index([detected_at(sort: Desc)], map: "idx_regulatory_updates_detected")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model risk_alerts {
  id                       String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  system_id                String?   @db.Uuid
  assessment_id            String?   @db.Uuid
  alert_type               String
  severity                 String
  title                    String
  message                  String
  matched_pattern_id       String?   @db.Uuid
  matched_vulnerability_id String?   @db.Uuid
  risk_score_at_alert      Int?
  recommended_actions      Json?
  status                   String?   @default("active")
  acknowledged             Boolean?  @default(false)
  acknowledged_by          String?
  acknowledged_at          DateTime? @db.Timestamp(6)
  resolved_at              DateTime? @db.Timestamp(6)
  resolution_notes         String?
  notification_sent        Boolean?  @default(false)
  notification_channels    Json?
  notification_sent_at     DateTime? @db.Timestamp(6)
  created_at               DateTime  @default(now()) @db.Timestamp(6)
  updated_at               DateTime  @default(now()) @db.Timestamp(6)
  metadata                 Json?

  @@index([created_at(sort: Desc)], map: "idx_alert_created")
  @@index([severity], map: "idx_alert_severity")
  @@index([status], map: "idx_alert_status")
  @@index([system_id], map: "idx_alert_system")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model risk_assessments {
  id                       String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  system_id                String?  @db.Uuid
  risk_score               Int
  risk_level               String
  performance_score        Int?
  drift_score              Int?
  latency_score            Int?
  bias_score               Int?
  security_score           Int?
  compliance_score         Int?
  cost_score               Int?
  matched_failure_patterns Json?
  matched_vulnerabilities  Json?
  compliance_gaps          Json?
  warnings                 Json?
  recommendations          Json?
  metrics_snapshot         Json?
  assessed_at              DateTime @default(now()) @db.Timestamp(6)
  assessment_duration_ms   Int?
  assessment_version       String?
  metadata                 Json?

  @@index([assessed_at(sort: Desc)], map: "idx_risk_assessed")
  @@index([risk_level], map: "idx_risk_level")
  @@index([risk_score(sort: Desc)], map: "idx_risk_score")
  @@index([system_id], map: "idx_risk_system")
}

model risk_signals {
  id                    String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  regulation_id         String?   @db.Uuid
  update_id             String?   @db.Uuid
  signal_type           String
  severity              String
  title                 String
  description           String?
  affected_industries   String[]
  action_required       String?
  deadline              DateTime? @db.Date
  risk_score            Decimal?  @db.Decimal
  sent_to_frontend      Boolean?  @default(false)
  frontend_acknowledged Boolean?  @default(false)
  acknowledged_at       DateTime? @db.Timestamp(6)
  created_at            DateTime? @default(now()) @db.Timestamp(6)

  @@index([sent_to_frontend, created_at(sort: Desc)], map: "idx_risk_signals_sent")
  @@index([severity, created_at(sort: Desc)], map: "idx_risk_signals_severity")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model risklens_compliance_matches {
  id                        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  project_id                String?  @db.Uuid
  compliance_requirement_id String?  @db.Uuid
  relevance_score           Float
  is_mandatory              Boolean? @default(false)
  estimated_cost            Int?
  estimated_timeline_weeks  Int?
  created_at                DateTime @default(now()) @db.Timestamp(6)

  @@index([project_id], map: "idx_risklens_compliance_project")
  @@index([compliance_requirement_id], map: "idx_risklens_compliance_requirement")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model risklens_feedback {
  id         Int       @id @default(autoincrement())
  project_id String    @unique
  rating     String    @db.VarChar(20)
  comments   String?
  created_at DateTime? @default(now()) @db.Timestamp(6)
  updated_at DateTime? @default(now()) @db.Timestamp(6)

  @@index([created_at], map: "idx_risklens_feedback_created_at")
  @@index([project_id], map: "idx_risklens_feedback_project_id")
  @@index([rating], map: "idx_risklens_feedback_rating")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model risklens_playbooks {
  id                       String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                     String
  risk_category            String
  failure_types            String[]
  description              String
  steps                    Json
  estimated_cost_min       Int
  estimated_cost_max       Int
  estimated_timeline_weeks Int
  industries               String[]
  model_types              String[]
  based_on_incidents       Int?     @default(0)
  success_rate             Float?
  created_at               DateTime @default(now()) @db.Timestamp(6)
  updated_at               DateTime @default(now()) @db.Timestamp(6)

  @@index([risk_category], map: "idx_risklens_playbooks_category")
  @@index([failure_types], map: "idx_risklens_playbooks_failure_types", type: Gin)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model risklens_processing_queue {
  id                         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  scrape_id                  String?   @db.Uuid
  content_type               String?
  processing_status          String?   @default("pending")
  extracted_failure_id       String?   @db.Uuid
  extracted_compliance_id    String?   @db.Uuid
  extracted_benchmark_id     String?   @db.Uuid
  extracted_vulnerability_id String?   @db.Uuid
  error_message              String?
  retry_count                Int?      @default(0)
  max_retries                Int?      @default(3)
  created_at                 DateTime  @default(now()) @db.Timestamp(6)
  processing_started_at      DateTime? @db.Timestamp(6)
  processed_at               DateTime? @db.Timestamp(6)
  processing_duration_ms     Int?
  metadata                   Json?

  @@index([content_type], map: "idx_risklens_queue_content_type")
  @@index([processing_status], map: "idx_risklens_queue_status")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model risklens_projects {
  id                         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id                    String?  @db.Uuid
  project_name               String
  industry                   String
  use_case                   String
  company_size               String
  ai_maturity                String
  model_type                 String[]
  deployment_env             String
  data_sensitivity           String[]
  scale_metrics              Json
  compliance_requirements    String[]
  security_concerns          String[]
  business_impact            Json
  budget_range               String
  timeline                   String
  team_size                  Int
  overall_risk_score         Int?
  performance_risk           Int?
  security_risk              Int?
  compliance_risk            Int?
  operational_risk           Int?
  top_risks                  Json?
  mitigation_cost_estimate   Int?
  mitigation_timeline_months Int?
  recommendation             Json?
  success_probability        Float?
  roi_estimate               Int?
  payback_period_months      Int?
  net_value                  Int?
  is_anonymous               Boolean? @default(true)
  access_token               String?  @unique
  created_at                 DateTime @default(now()) @db.Timestamp(6)
  updated_at                 DateTime @default(now()) @db.Timestamp(6)
  user_ip                    String?
  project_description        String?

  @@index([access_token], map: "idx_risklens_projects_access_token")
  @@index([created_at(sort: Desc)], map: "idx_risklens_projects_created")
  @@index([overall_risk_score(sort: Desc)], map: "idx_risklens_projects_risk_score")
  @@index([user_id], map: "idx_risklens_projects_user")
  @@index([user_id, created_at(sort: Desc)], map: "idx_risklens_projects_user_created")
  @@index([user_ip, created_at(sort: Desc)], map: "idx_risklens_projects_user_ip")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model risklens_risk_matches {
  id                 String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  project_id         String?  @db.Uuid
  failure_pattern_id String?  @db.Uuid
  relevance_score    Float
  risk_category      String
  industry_match     Boolean? @default(false)
  use_case_match     Boolean? @default(false)
  model_type_match   Boolean? @default(false)
  created_at         DateTime @default(now()) @db.Timestamp(6)

  @@index([failure_pattern_id], map: "idx_risklens_matches_failure")
  @@index([project_id], map: "idx_risklens_matches_project")
  @@index([relevance_score(sort: Desc)], map: "idx_risklens_matches_relevance")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model risklens_subscriptions {
  id                     String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id                String    @unique @db.Uuid
  tier                   String
  status                 String
  stripe_subscription_id String?   @unique
  stripe_customer_id     String?
  stripe_price_id        String?
  amount_cents           Int?
  currency               String?   @default("USD")
  billing_interval       String?
  trial_ends_at          DateTime? @db.Timestamp(6)
  started_at             DateTime  @default(now()) @db.Timestamp(6)
  expires_at             DateTime? @db.Timestamp(6)
  cancelled_at           DateTime? @db.Timestamp(6)
  created_at             DateTime  @default(now()) @db.Timestamp(6)
  updated_at             DateTime  @default(now()) @db.Timestamp(6)

  @@index([status], map: "idx_risklens_subs_status")
  @@index([stripe_subscription_id], map: "idx_risklens_subs_stripe")
  @@index([user_id], map: "idx_risklens_subs_user")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model risklens_usage {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id    String?  @db.Uuid
  project_id String?  @db.Uuid
  action     String
  metadata   Json?
  created_at DateTime @default(now()) @db.Timestamp(6)

  @@index([created_at(sort: Desc)], map: "idx_risklens_usage_created")
  @@index([project_id], map: "idx_risklens_usage_project")
  @@index([user_id], map: "idx_risklens_usage_user")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains an index with non-default null sort order and requires additional setup for migrations. Visit https://pris.ly/d/default-index-null-ordering for more info.
model roi_risklens_synergy {
  id                      String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  failure_pattern_id      String?   @db.Uuid
  scrape_id               String?   @db.Uuid
  implementation_cost_min Decimal?  @db.Decimal
  implementation_cost_max Decimal?  @db.Decimal
  cost_currency           String?   @default("USD")
  annual_savings_min      Decimal?  @db.Decimal
  annual_savings_max      Decimal?  @db.Decimal
  payback_period_months   Int?
  roi_percentage          Decimal?  @db.Decimal
  failure_cost_min        Decimal?  @db.Decimal
  failure_cost_max        Decimal?  @db.Decimal
  failure_cost_median     Decimal?  @db.Decimal
  downtime_hours_avg      Decimal?  @db.Decimal
  customer_impact_count   Int?
  industry                String?
  company_size            String?
  use_case                String?
  source_url              String?
  source_company          String?
  source_date             DateTime? @db.Date
  confidence_score        Float?
  applies_to_use_cases    String[]
  created_at              DateTime  @default(now()) @db.Timestamp(6)
  updated_at              DateTime  @default(now()) @db.Timestamp(6)

  @@index([failure_cost_median(sort: Desc)], map: "idx_synergy_cost")
  @@index([failure_pattern_id], map: "idx_synergy_failure")
  @@index([industry], map: "idx_synergy_industry")
  @@index([use_case], map: "idx_synergy_use_case")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model scout_logs {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  level        String
  logger_name  String
  message      String
  scraper_type String?
  source_url   String?
  job_id       String?  @db.Uuid
  exception    String?
  stack_trace  String?
  created_at   DateTime @default(now()) @db.Timestamp(6)
  metadata     Json?

  @@index([created_at(sort: Desc)], map: "idx_logs_created")
  @@index([level, created_at(sort: Desc)], map: "idx_logs_level")
  @@index([scraper_type], map: "idx_logs_scraper")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model scout_statistics {
  id                      String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  period_start            DateTime @db.Timestamp(6)
  period_end              DateTime @db.Timestamp(6)
  period_type             String
  total_scrapes           Int?     @default(0)
  successful_scrapes      Int?     @default(0)
  failed_scrapes          Int?     @default(0)
  total_metrics_extracted Int?     @default(0)
  total_changes_detected  Int?     @default(0)
  avg_scrape_time_ms      Int?
  total_data_volume_mb    Float?
  stats_by_source         Json?
  stats_by_data_type      Json?
  created_at              DateTime @default(now()) @db.Timestamp(6)

  @@unique([period_type, period_start])
  @@index([period_type, period_start(sort: Desc)], map: "idx_stats_period")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model scraped_financial_data {
  id                 String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  source             String
  source_url         String
  scraper_type       String
  data_type          String
  raw_content        String?
  raw_content_hash   String?
  content_type       String?
  company_identifier String?
  company_name       String?
  ticker_symbol      String?
  domain             String?
  extracted_data     Json?
  confidence_score   Float?
  quality_score      Float?
  extraction_method  String?
  scraped_at         DateTime  @default(now()) @db.Timestamp(6)
  content_date       DateTime? @db.Timestamp(6)
  valid_until        DateTime? @db.Timestamp(6)
  http_status        Int?
  response_time_ms   Int?
  scraper_version    String?
  metadata           Json?
  created_at         DateTime  @default(now()) @db.Timestamp(6)
  updated_at         DateTime  @default(now()) @db.Timestamp(6)

  @@index([company_identifier], map: "idx_scraped_company")
  @@index([data_type], map: "idx_scraped_data_type")
  @@index([scraped_at(sort: Desc)], map: "idx_scraped_date")
  @@index([domain], map: "idx_scraped_domain")
  @@index([extracted_data], map: "idx_scraped_extracted_data", type: Gin)
  @@index([company_identifier], map: "idx_scraped_financial_company")
  @@index([scraped_at(sort: Desc)], map: "idx_scraped_financial_date")
  @@index([raw_content_hash], map: "idx_scraped_financial_hash")
  @@index([source], map: "idx_scraped_financial_source")
  @@index([raw_content_hash], map: "idx_scraped_hash")
  @@index([source], map: "idx_scraped_source")
  @@index([ticker_symbol], map: "idx_scraped_ticker")
}

model security_vulnerabilities {
  id                        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  source_scrape_id          String?   @db.Uuid
  cve_id                    String?   @unique
  attack_type               String
  vulnerability_name        String?
  description               String?
  target_model_type         String?
  affected_systems          String[]
  affected_versions         String[]
  severity                  String
  cvss_score                Float?
  success_rate              Float?
  exploited_in_wild         Boolean?  @default(false)
  attack_complexity         String?
  requires_privileges       Boolean?  @default(false)
  user_interaction_required Boolean?  @default(false)
  attack_vector             String?
  example_payload           String?
  indicators_of_compromise  Json?
  mitigation                String?
  detection_method          String?
  patch_available           Boolean?  @default(false)
  patch_details             String?
  workaround                String?
  disclosed_at              DateTime? @db.Timestamp(6)
  published_at              DateTime? @db.Timestamp(6)
  patched_at                DateTime? @db.Timestamp(6)
  confidence_score          Float?
  is_verified               Boolean?  @default(false)
  created_at                DateTime  @default(now()) @db.Timestamp(6)
  updated_at                DateTime  @default(now()) @db.Timestamp(6)
  verified_by               String?
  verified_at               DateTime? @db.Timestamp(6)
  source_url                String?
  nvd_url                   String?
  reference_urls            Json?
  tags                      String[]
  notes                     String?
  extraction_method         String?

  @@index([affected_systems], map: "idx_vuln_affected", type: Gin)
  @@index([attack_type], map: "idx_vuln_attack_type")
  @@index([cve_id], map: "idx_vuln_cve")
  @@index([disclosed_at(sort: Desc)], map: "idx_vuln_disclosed")
  @@index([severity], map: "idx_vuln_severity")
  @@index([tags], map: "idx_vuln_tags", type: Gin)
  @@index([target_model_type], map: "idx_vuln_target")
}

model sengol_score_history {
  id                      String   @id
  projectId               String
  score                   Float
  grade                   String
  trend                   String
  trendDescription        String
  riskPosture             Float
  complianceHealth        Float
  coverage                Float
  recency                 Float
  consistency             Float
  daysSinceLastAssessment Int
  insights                Json
  recommendations         Json
  createdAt               DateTime @default(now())
  Project                 Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([projectId])
  @@index([score])
}

model source_discovery_queue {
  id                Int       @id @default(autoincrement())
  potential_url     String
  domain            String    @db.VarChar(20)
  source_type       String?   @db.VarChar(50)
  discovered_via    String?   @db.VarChar(100)
  confidence_score  Float     @default(0.5)
  validation_status String    @default("pending") @db.VarChar(20)
  validation_notes  String?
  created_at        DateTime  @default(now())
  validated_at      DateTime?

  @@index([created_at])
  @@index([validation_status, domain])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model source_registry {
  id                    String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  source_name           String    @db.VarChar(255)
  source_url            String    @unique
  source_type           String    @db.VarChar(50)
  category              String    @db.VarChar(50)
  discovery_method      String?   @default("manual") @db.VarChar(50)
  discovered_at         DateTime? @default(now()) @db.Timestamp(6)
  quality_score         Int?
  enabled               Boolean?  @default(false)
  verified              Boolean?  @default(false)
  verification_date     DateTime? @db.Timestamp(6)
  priority              Int?      @default(10)
  schedule_cron         String?   @default("0 2 * * *") @db.VarChar(50)
  last_crawled_at       DateTime? @db.Timestamp(6)
  next_scheduled_crawl  DateTime? @db.Timestamp(6)
  crawler_class         String?   @db.VarChar(100)
  crawl_config          Json?     @default("{}")
  target_table          String?   @db.VarChar(100)
  avg_records_per_crawl Int?      @default(0)
  avg_duration_seconds  Int?      @default(0)
  success_rate          Decimal?  @default(0.00) @db.Decimal(5, 2)
  consecutive_failures  Int?      @default(0)
  last_error_message    String?
  last_error_at         DateTime? @db.Timestamp(6)
  description           String?
  tags                  Json?     @default("[]")
  metadata              Json?     @default("{}")
  created_at            DateTime? @default(now()) @db.Timestamp(6)
  updated_at            DateTime? @default(now()) @db.Timestamp(6)
  created_by            String?   @db.VarChar(100)
  updated_by            String?   @db.VarChar(100)

  @@index([enabled], map: "idx_source_registry_enabled")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model user_ai_systems {
  id                      String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id                 String?   @db.Uuid
  organization_id         String?   @db.Uuid
  system_name             String
  system_description      String?
  use_case                String
  industry                String?
  model_type              String?
  deployment_date         DateTime? @db.Date
  deployment_scale        String?
  production_url          String?
  environment             String?
  monitoring_enabled      Boolean?  @default(true)
  monitoring_frequency    String?   @default("hourly")
  alert_thresholds        Json?
  current_risk_score      Int?
  risk_trend              String?
  last_risk_assessment    DateTime? @db.Timestamp(6)
  baseline_metrics        Json?
  baseline_established_at DateTime? @db.Timestamp(6)
  created_at              DateTime  @default(now()) @db.Timestamp(6)
  updated_at              DateTime  @default(now()) @db.Timestamp(6)
  is_active               Boolean?  @default(true)
  archived_at             DateTime? @db.Timestamp(6)
  tags                    String[]
  notes                   String?
  metadata                Json?

  @@index([organization_id], map: "idx_user_systems_org")
  @@index([use_case], map: "idx_user_systems_use_case")
  @@index([user_id], map: "idx_user_systems_user")
}

enum ApprovalStatus {
  APPROVED
  REJECTED
  PENDING
  CONDITIONAL
}

// ==================== AI Risk Council Models ====================

model council_Policy {
  id               String   @id @default(cuid())
  name             String
  description      String?
  category         String
  severity         String   @default("MEDIUM") // HIGH, MEDIUM, LOW
  status           String   @default("DRAFT") // DRAFT, ACTIVE, ARCHIVED
  version          Int      @default(1)
  conditions       String   // JSON stringified PolicyConditionGroup
  actions          String   // JSON stringified PolicyActions
  geographyAccountId String
  createdBy        String
  createdAt        DateTime @default(now())
  updatedAt        DateTime @default(now()) @db.Timestamp(6)
  violations       council_Violation[]

  @@index([geographyAccountId])
  @@index([status])
}

model council_Violation {
  id               String   @id @default(cuid())
  policyId         String
  assessmentId     String?
  vendorId         String?
  status           String   @default("OPEN") // OPEN, RESOLVED, WONT_FIX
  severity         String
  detectedAt       DateTime @default(now())
  resolvedAt       DateTime?
  description      String
  evidence         String?  // JSON stringified evidence
  geographyAccountId String
  createdAt        DateTime @default(now())
  updatedAt        DateTime @default(now()) @db.Timestamp(6)
  policy           council_Policy @relation(fields: [policyId], references: [id], onDelete: Cascade)

  @@index([policyId])
  @@index([geographyAccountId])
  @@index([status])
}

model council_Vendor {
  id               String   @id @default(cuid())
  name             String
  type             String
  status           String   @default("ACTIVE") // ACTIVE, INACTIVE, BLACKLISTED
  riskLevel        String   @default("MEDIUM") // HIGH, MEDIUM, LOW
  lastAssessmentDate DateTime?
  metadata         String?  // JSON stringified vendor metadata
  geographyAccountId String
  createdAt        DateTime @default(now())
  updatedAt        DateTime @default(now()) @db.Timestamp(6)
  assessments      council_VendorAssessment[]
  scorecards       council_VendorScorecard[]

  @@index([geographyAccountId])
  @@index([status])
}

model council_VendorAssessment {
  id               String   @id @default(cuid())
  vendorId         String
  type             String   // SECURITY, COMPLIANCE, OPERATIONAL
  status           String   @default("IN_PROGRESS") // IN_PROGRESS, COMPLETED, FAILED
  questions        String   // JSON stringified assessment questions
  results          String   // JSON stringified assessment results
  overallScore     Float    @default(0.0)
  geographyAccountId String
  createdAt        DateTime @default(now())
  updatedAt        DateTime @default(now()) @db.Timestamp(6)
  vendor           council_Vendor @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@index([vendorId])
  @@index([geographyAccountId])
}

model council_VendorScorecard {
  id               String   @id @default(cuid())
  vendorId         String
  assessmentPeriod String
  overallScore     Float
  securityScore    Float    @default(0.0)
  complianceScore  Float    @default(0.0)
  operationalScore Float    @default(0.0)
  metadata         String?  // JSON stringified scorecard metadata
  geographyAccountId String
  createdAt        DateTime @default(now())
  updatedAt        DateTime @default(now()) @db.Timestamp(6)
  vendor           council_Vendor @relation(fields: [vendorId], references: [id], onDelete: Cascade)

  @@index([vendorId])
  @@index([geographyAccountId])
}

model council_Schedule {
  id               String   @id @default(cuid())
  name             String
  description      String?
  frequency        String   // DAILY, WEEKLY, BIWEEKLY, MONTHLY, QUARTERLY, ANNUALLY
  assessmentType   String
  policyIds        String   // JSON stringified array of policy IDs
  isActive         Boolean  @default(true)
  nextRunAt        DateTime
  geographyAccountId String
  createdAt        DateTime @default(now())
  updatedAt        DateTime @default(now()) @db.Timestamp(6)
  metadata         String?  // JSON stringified schedule metadata
  runs             council_ScheduleRun[]

  @@index([geographyAccountId])
  @@index([isActive])
}

model council_ScheduleRun {
  id               String   @id @default(cuid())
  scheduleId       String
  status           String   // IN_PROGRESS, COMPLETED, FAILED
  startedAt        DateTime @default(now())
  completedAt      DateTime?
  results          String   // JSON stringified run results
  geographyAccountId String
  createdAt        DateTime @default(now())
  updatedAt        DateTime @default(now()) @db.Timestamp(6)
  schedule         council_Schedule @relation(fields: [scheduleId], references: [id], onDelete: Cascade)

  @@index([scheduleId])
  @@index([geographyAccountId])
}

// ==================== Enums ====================

enum CouncilRole {
  CHAIR
  PARTNER
  OBSERVER
}

enum CouncilStatus {
  ACTIVE
  ARCHIVED
  SUSPENDED
}

enum LedgerEntryType {
  APPROVAL
  REJECTION
  STATUS_CHANGE
  ASSIGNMENT
  MEMBER_ADDED
  MEMBER_REVOKED
  POLICY_CHANGE
  SYSTEM_EVENT
}

enum MembershipStatus {
  ACTIVE
  REVOKED
  SUSPENDED
}
